function J(h){function q(A){A.stopPropagation();const{offsetX:N,offsetY:W}=A,Z=Math.min(Math.floor(N/h.ui.cellSize),8),X=Math.min(Math.floor(W/h.ui.cellSize),8),$=h.getSelectedCell();if($===null||$[0]!==Z||$[1]!==X)h.setSelectedCell([Z,X]),h.refreshGrid()}function B(A){if(A.stopPropagation(),h.getSelectedCell()!==null)h.setSelectedCell(null),h.refreshGrid()}function L(A){if(A.stopPropagation(),A.key>="1"&&A.key<="9"&&h.getSelectedCell()!==null)h.toggle(parseInt(A.key))}h.canvas.addEventListener("mousemove",q),h.canvas.addEventListener("mouseout",B),document.onkeyup=L}class Q{h;q;static _uis=new WeakMap;static bgColor="#DDD";static thinLineColor="#AAA";static boldLineColor="#000";static impactedColor="#eec";static selectedColor="#ff6";static get(h){if(Q._uis.has(h))return Q._uis.get(h);const q=h.getContext("2d");if(q===null)return!1;const B=new Q(h,q);return Q._uis.set(h,B),B}_cellSize;constructor(h,q){this._canvas=h;this._ctx=q;this._cellSize=Math.round(Math.min(h.width,h.height)/9)}get width(){return this._canvas.width}get height(){return this._canvas.height}get cellSize(){return this._cellSize}clearCanvas(){return this._ctx.fillStyle=Q.bgColor,this._ctx.fillRect(0,0,this.width,this.height),this}drawCell(h,q,B=this._cellSize,L=Q.thinLineColor,A){const N=h*B,W=q*B;if(A)this._ctx.fillStyle=A,this._ctx.fillRect(N+1,W+1,B-2,B-2);return this._ctx.strokeStyle=L,this._ctx.strokeRect(N,W,B,B),this}drawRow(h,q){for(let B=0;B<9;B++)this.drawCell(B,h,this._cellSize,Q.thinLineColor,q);return this}drawColumn(h,q){for(let B=0;B<9;B++)this.drawCell(h,B,this._cellSize,Q.thinLineColor,q);return this}drawGroup(h,q,B){this.drawCell(h,q,this._cellSize*3,Q.boldLineColor,B);for(let L=0;L<3;L++)for(let A=0;A<3;A++)this.drawCell(h*3+A,q*3+L,this._cellSize,Q.thinLineColor);return this}drawCellValue(h,q,B){this._ctx.fillStyle="#000",this._ctx.font="bold 60px Arial",this._ctx.textBaseline="middle",this._ctx.textAlign="center";const L=h*this._cellSize+Math.floor(this._cellSize*0.5),A=q*this._cellSize+Math.floor(this._cellSize*0.575);return this._ctx.fillText(B.toString(),L,A),this}drawCellDomain(h,q,B){this._ctx.fillStyle="#000",this._ctx.font="16px Arial",this._ctx.textBaseline="top",this._ctx.textAlign="start";const L=Math.max(this._cellSize-2,Math.floor(this._cellSize*0.8)),A=Math.floor(L/3),N=Math.max(1,Math.floor(this._cellSize*0.1)),W=h*this._cellSize+N,Z=q*this._cellSize+N;for(let X=1;X<=9;X++){const $=B.contains(X)?X:null,T=(X-1)%3,P=Math.floor((X-1)/3),O=W+A*T,E=Z+A*P;this._ctx.fillText($!==null?$.toString():"",O,E)}return this}drawEmptyGrid(){this.clearCanvas();for(let h=0;h<3;h++)for(let q=0;q<3;q++)this.drawGroup(q,h);return this}colorizeSelectedStuff(h){if(h===null)return this;const q=[Math.floor(h[0]/3),Math.floor(h[1]/3)];return this.drawRow(h[1],Q.impactedColor).drawColumn(h[0],Q.impactedColor).drawGroup(q[0],q[1],Q.impactedColor).drawCell(h[0],h[1],this._cellSize,Q.thinLineColor,Q.selectedColor),this}}function f(){const h=new WebSocket(`ws://${location.host}`);h.onopen=()=>setInterval(()=>h.send("ping"),5000),h.onmessage=(q)=>{if(q.data!=="Well received")console.log(q.data);if(q.data==="reload")location.reload()}}class b{_values;constructor(h){this._values=h}remove(h){const q=this._values.indexOf(h);if(q!==-1)this._values.splice(q,1)}add(h){if(!this._values.includes(h))this._values.push(h)}contains(h){return this._values.includes(h)}copy(){return new b(this._values)}toJSON(){return JSON.stringify(this._values)}}var G=function(h){const q=document.getElementById(h);if(q===null)return console.error("Cannot get the given Canvas 2D rendering context"),!1;const B=Q.get(q);if(!B)return!1;const L=[],A=[];for(let N=0;N<9;N++){L.push([]),A.push([]);for(let W=0;W<9;W++){let Z=new b([1,2,3,4,5,6,7,8,9]);L[N].push(Z),A[N].push(null)}}return{canvas:q,ui:B,cellDomains:L,cellValues:A}},D=function(h){const{canvas:q,ui:B,cellDomains:L,cellValues:A}=h;let N=null;function W(E,K){if(A[K][E]!==null)B.drawCellValue(E,K,A[K][E]);else B.drawCellDomain(E,K,L[K][E])}function Z(){for(let E=0;E<9;E++)for(let K=0;K<9;K++)W(K,E)}function X(E,K,R){L[K][E].remove(R)}function $(E,K,R){L[K][E].add(R)}function T(E,K,R,F){const H=F?X:$;for(let Y=0;Y<9;Y++){if(Y!==E)H(Y,K,R);if(Y!==K)H(E,Y,R)}const g=Math.floor(E/3),x=Math.floor(K/3);for(let Y=0;Y<3;Y++)for(let y=0;y<3;y++){const M=g*3+y,_=x*3+Y;if(M!==E&&_!==K)H(M,_,R)}}function P(E){const K=N[0],R=N[1];if(A[R][K]===null){if(L[R][K].contains(E))A[R][K]=E,T(K,R,E,!0),O()}else if(A[R][K]===E){A[R][K]=null,T(K,R,E,!1);for(let F=0;F<9;F++)for(let H=0;H<9;H++)if(A[F][H]===E)T(H,F,E,!0);O()}}function O(){B.drawEmptyGrid().colorizeSelectedStuff(N),Z()}J({canvas:q,ui:B,refreshGrid:O,toggle:P,getSelectedCell:()=>N,setSelectedCell:(E)=>N=E}),f(),O()},w=G("sudokuCanvas");if(w)D(w);
