function G(h){function N(q){q.stopPropagation();const{offsetX:L,offsetY:T}=q,X=Math.min(Math.floor(L/h.ui.cellSize),8),R=Math.min(Math.floor(T/h.ui.cellSize),8),Y=h.getSelectedCell();if(Y===null||Y[0]!==X||Y[1]!==R)h.setSelectedCell([X,R]),h.refreshGrid()}function A(q){if(q.stopPropagation(),h.getSelectedCell()!==null)h.setSelectedCell(null),h.refreshGrid()}function K(q){if(q.stopPropagation(),q.key>="1"&&q.key<="9"&&h.getSelectedCell()!==null)h.toggle(parseInt(q.key))}h.canvas.addEventListener("mousemove",N),h.canvas.addEventListener("mouseout",A),document.onkeyup=K}class O{h;N;static _uis=new WeakMap;static bgColor="#DDD";static thinLineColor="#AAA";static boldLineColor="#000";static impactedColor="#eec";static selectedColor="#ff6";static get(h){if(O._uis.has(h))return O._uis.get(h);const N=h.getContext("2d");if(N===null)return!1;const A=new O(h,N);return O._uis.set(h,A),A}_cellSize;constructor(h,N){this._canvas=h;this._ctx=N;this._cellSize=Math.round(Math.min(h.width,h.height)/9)}get width(){return this._canvas.width}get height(){return this._canvas.height}get cellSize(){return this._cellSize}clearCanvas(){return this._ctx.fillStyle=O.bgColor,this._ctx.fillRect(0,0,this.width,this.height),this}drawCell(h,N,A=this._cellSize,K=O.thinLineColor,q){const L=h*A,T=N*A;if(q)this._ctx.fillStyle=q,this._ctx.fillRect(L+1,T+1,A-2,A-2);return this._ctx.strokeStyle=K,this._ctx.strokeRect(L,T,A,A),this}drawRow(h,N){for(let A=0;A<9;A++)this.drawCell(A,h,this._cellSize,O.thinLineColor,N);return this}drawColumn(h,N){for(let A=0;A<9;A++)this.drawCell(h,A,this._cellSize,O.thinLineColor,N);return this}drawGroup(h,N,A){this.drawCell(h,N,this._cellSize*3,O.boldLineColor,A);for(let K=0;K<3;K++)for(let q=0;q<3;q++)this.drawCell(h*3+q,N*3+K,this._cellSize,O.thinLineColor);return this}drawCellValue(h,N,A){this._ctx.fillStyle="#000",this._ctx.font="bold 60px Arial",this._ctx.textBaseline="middle",this._ctx.textAlign="center";const K=h*this._cellSize+Math.floor(this._cellSize*0.5),q=N*this._cellSize+Math.floor(this._cellSize*0.575);return this._ctx.fillText(A,K,q),this}drawCellDomain(h,N,A){this._ctx.fillStyle="#000",this._ctx.font="16px Arial",this._ctx.textBaseline="top",this._ctx.textAlign="start";const K=Math.max(this._cellSize-2,Math.floor(this._cellSize*0.8)),q=Math.floor(K/3),L=Math.max(1,Math.floor(this._cellSize*0.1)),T=h*this._cellSize+L,X=N*this._cellSize+L;for(let R=1;R<=9;R++){const Y=A.has(R)?R:null,H=(R-1)%3,J=Math.floor((R-1)/3),F=T+q*H,B=X+q*J;this._ctx.fillText(Y!==null?Y.toString():"",F,B)}return this}drawEmptyGrid(){this.clearCanvas();for(let h=0;h<3;h++)for(let N=0;N<3;N++)this.drawGroup(N,h);return this}colorizeSelectedStuff(h){if(h===null)return this;const N=[Math.floor(h[0]/3),Math.floor(h[1]/3)];return this.drawRow(h[1],O.impactedColor).drawColumn(h[0],O.impactedColor).drawGroup(N[0],N[1],O.impactedColor).drawCell(h[0],h[1],this._cellSize,O.thinLineColor,O.selectedColor),this}}function w(){const h=new WebSocket(`ws://${location.host}`);h.onopen=()=>setInterval(()=>h.send("ping"),5000),h.onmessage=(N)=>{if(N.data!=="Well received")console.log(N.data);if(N.data==="reload")location.reload()}}class P{_values;constructor(h){this._values=h}del(h){const N=this._values.indexOf(h);if(N!==-1)this._values.splice(N,1)}add(h){if(!this._values.includes(h))this._values.push(h)}has(h){return this._values.includes(h)}copy(){return new P(this._values)}toJSON(){return JSON.stringify(this._values)}fromJSON(h){this._values=h}}class b{_value=null;set(h){this._value=h}unset(){this._value=null}toJson(){return JSON.stringify(this._value)}get(){return this._value}fromJson(h){this._value=JSON.parse(h)}}var V=function(h){const N=document.getElementById(h);if(N===null)return console.error("Cannot get the given Canvas 2D rendering context"),!1;const A=O.get(N);if(!A)return!1;const K=[],q=[];for(let L=0;L<9;L++){K.push([]),q.push([]);for(let T=0;T<9;T++){let X=new P([1,2,3,4,5,6,7,8,9]),R=new b;K[L].push(X),q[L].push(R)}}return{canvas:N,ui:A,cellDomains:K,cellValues:q}},z=function(h){const{canvas:N,ui:A,cellDomains:K,cellValues:q}=h;let L=null;function T(B,E){if(q[E][B].get()!==null)A.drawCellValue(B,E,q[E][B].get());else A.drawCellDomain(B,E,K[E][B])}function X(){for(let B=0;B<9;B++)for(let E=0;E<9;E++)T(E,B)}function R(B,E,Q){K[E][B].del(Q)}function Y(B,E,Q){K[E][B].add(Q)}function H(B,E,Q,Z){const $=Z?R:Y;for(let W=0;W<9;W++){if(W!==B)$(W,E,Q);if(W!==E)$(B,W,Q)}const f=Math.floor(B/3),g=Math.floor(E/3);for(let W=0;W<3;W++)for(let M=0;M<3;M++){const y=f*3+M,_=g*3+W;if(y!==B&&_!==E)$(y,_,Q)}}function J(B){const E=L[0],Q=L[1];if(q[Q][E].get()===null){if(K[Q][E].has(B))q[Q][E].set(B),H(E,Q,B,!0),F()}else if(q[Q][E].get()===B){q[Q][E].unset(),H(E,Q,B,!1);for(let Z=0;Z<9;Z++)for(let $=0;$<9;$++)if(q[Z][$].get()===B)H($,Z,B,!0);F()}}function F(){A.drawEmptyGrid().colorizeSelectedStuff(L),X()}G({canvas:N,ui:A,refreshGrid:F,toggle:J,getSelectedCell:()=>L,setSelectedCell:(B)=>L=B}),w(),F()},x=V("sudokuCanvas");if(x)z(x);
