function w(h){function q(B){B.stopPropagation();const{offsetX:N,offsetY:Y}=B,$=Math.min(Math.floor(N/h.ui.cellSize),8),W=Math.min(Math.floor(Y/h.ui.cellSize),8),X=h.getSelectedCell();if(X===null||X[0]!==$||X[1]!==W)h.setSelectedCell([$,W]),h.refreshGrid()}function A(B){if(B.stopPropagation(),h.getSelectedCell()!==null)h.setSelectedCell(null),h.refreshGrid()}function L(B){if(B.stopPropagation(),B.key>="1"&&B.key<="9"&&h.getSelectedCell()!==null)h.toggle(parseInt(B.key))}h.canvas.addEventListener("mousemove",q),h.canvas.addEventListener("mouseout",A),document.onkeyup=L}class Q{h;q;static _uis=new WeakMap;static bgColor="#DDD";static thinLineColor="#AAA";static boldLineColor="#000";static impactedColor="#eec";static selectedColor="#ff6";static get(h){if(Q._uis.has(h))return Q._uis.get(h);const q=h.getContext("2d");if(q===null)return!1;const A=new Q(h,q);return Q._uis.set(h,A),A}_cellSize;constructor(h,q){this._canvas=h;this._ctx=q;this._cellSize=Math.round(Math.min(h.width,h.height)/9)}get width(){return this._canvas.width}get height(){return this._canvas.height}get cellSize(){return this._cellSize}clearCanvas(){return this._ctx.fillStyle=Q.bgColor,this._ctx.fillRect(0,0,this.width,this.height),this}drawCell(h,q,A=this._cellSize,L=Q.thinLineColor,B){const N=h*A,Y=q*A;if(B)this._ctx.fillStyle=B,this._ctx.fillRect(N+1,Y+1,A-2,A-2);return this._ctx.strokeStyle=L,this._ctx.strokeRect(N,Y,A,A),this}drawRow(h,q){for(let A=0;A<9;A++)this.drawCell(A,h,this._cellSize,Q.thinLineColor,q);return this}drawColumn(h,q){for(let A=0;A<9;A++)this.drawCell(h,A,this._cellSize,Q.thinLineColor,q);return this}drawGroup(h,q,A){this.drawCell(h,q,this._cellSize*3,Q.boldLineColor,A);for(let L=0;L<3;L++)for(let B=0;B<3;B++)this.drawCell(h*3+B,q*3+L,this._cellSize,Q.thinLineColor);return this}drawCellValue(h,q,A){this._ctx.fillStyle="#000",this._ctx.font="bold 60px Arial",this._ctx.textBaseline="middle",this._ctx.textAlign="center";const L=h*this._cellSize+Math.floor(this._cellSize*0.5),B=q*this._cellSize+Math.floor(this._cellSize*0.575);return this._ctx.fillText(A.toString(),L,B),this}drawCellDomain(h,q,A){this._ctx.fillStyle="#000",this._ctx.font="16px Arial",this._ctx.textBaseline="top",this._ctx.textAlign="start";const L=Math.max(this._cellSize-2,Math.floor(this._cellSize*0.8)),B=Math.floor(L/3),N=Math.max(1,Math.floor(this._cellSize*0.1)),Y=h*this._cellSize+N,$=q*this._cellSize+N;for(let W=1;W<=9;W++){const X=A.contains(W)?W:null,F=(W-1)%3,y=Math.floor((W-1)/3),T=Y+B*F,E=$+B*y;this._ctx.fillText(X!==null?X.toString():"",T,E)}return this}drawEmptyGrid(){this.clearCanvas();for(let h=0;h<3;h++)for(let q=0;q<3;q++)this.drawGroup(q,h);return this}colorizeSelectedStuff(h){if(h===null)return this;const q=[Math.floor(h[0]/3),Math.floor(h[1]/3)];return this.drawRow(h[1],Q.impactedColor).drawColumn(h[0],Q.impactedColor).drawGroup(q[0],q[1],Q.impactedColor).drawCell(h[0],h[1],this._cellSize,Q.thinLineColor,Q.selectedColor),this}}function G(){const h=new WebSocket(`ws://${location.host}`);h.onopen=()=>setInterval(()=>h.send("ping"),5000),h.onmessage=(q)=>{if(q.data!=="Well received")console.log(q.data);if(q.data==="reload")location.reload()}}class P{_values;constructor(h){this._values=h}remove(h){const q=this._values.findIndex((A)=>A.get()===h);if(q!==-1)this._values[q].unset()}add(h){const q=this._values.findIndex((A)=>A.get()===null);if(q!==-1)this._values[q].set(h)}contains(h){return this._values.some((q)=>q.get()===h)}copy(){return new P(this._values)}toJSON(){let h=[];for(let q=0;q<this._values.length;q++)h.push(this._values[q].toJson());return JSON.stringify(h)}}class M{_value;set(h){this._value=h}unset(){this._value=null}toJson(){return JSON.stringify(this._value)}get(){return this._value}}var D=function(h){const q=document.getElementById(h);if(q===null)return console.error("Cannot get the given Canvas 2D rendering context"),!1;const A=Q.get(q);if(!A)return!1;const L=[],B=[];for(let N=0;N<9;N++){L.push([]),B.push([]);for(let Y=0;Y<9;Y++){let $=[];for(let X=1;X<=9;X++){let F=new M;F.set(X),$.push(F)}let W=new P($);L[N].push(W),B[N].push(null)}}return{canvas:q,ui:A,cellDomains:L,cellValues:B}},V=function(h){const{canvas:q,ui:A,cellDomains:L,cellValues:B}=h;let N=null;function Y(E,K){if(B[K][E]!==null)A.drawCellValue(E,K,B[K][E]);else A.drawCellDomain(E,K,L[K][E])}function $(){for(let E=0;E<9;E++)for(let K=0;K<9;K++)Y(K,E)}function W(E,K,R){L[K][E].remove(R)}function X(E,K,R){L[K][E].add(R)}function F(E,K,R,H){const O=H?W:X;for(let Z=0;Z<9;Z++){if(Z!==E)O(Z,K,R);if(Z!==K)O(E,Z,R)}const x=Math.floor(E/3),g=Math.floor(K/3);for(let Z=0;Z<3;Z++)for(let J=0;J<3;J++){const _=x*3+J,f=g*3+Z;if(_!==E&&f!==K)O(_,f,R)}}function y(E){const K=N[0],R=N[1];if(B[R][K]===null){if(L[R][K].contains(E))B[R][K]=E,F(K,R,E,!0),T()}else if(B[R][K]===E){B[R][K]=null,F(K,R,E,!1);for(let H=0;H<9;H++)for(let O=0;O<9;O++)if(B[H][O]===E)F(O,H,E,!0);T()}}function T(){A.drawEmptyGrid().colorizeSelectedStuff(N),$()}w({canvas:q,ui:A,refreshGrid:T,toggle:y,getSelectedCell:()=>N,setSelectedCell:(E)=>N=E}),G(),T(),document.getElementById("debugButton").addEventListener("click",(E)=>{E.stopPropagation(),E.preventDefault(),console.log(L[0][0].toJSON())})},b=D("sudokuCanvas");if(b)V(b);
